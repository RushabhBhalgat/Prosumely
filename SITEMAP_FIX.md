# Sitemap Configuration Fix

## Problem

The sitemap was not including URLs for pages in `src/app/(frontend)` because:

1. The `next-sitemap.config.cjs` was excluding all pages with `'/*'` and `'/posts/*'`
2. Static frontend routes were not being discovered automatically

## Solution

### 1. Updated `next-sitemap.config.cjs`

- Removed overly broad exclusions (`'/*'`, `'/posts/*'`)
- Added specific exclusions for admin, API, and internal paths
- Added a transform function to filter out dynamic routes and system files
- Now allows static frontend pages to be included in the main sitemap

### 2. Enhanced Dynamic Sitemap Generation

- Updated `pages-sitemap.xml/route.ts` to include both static and dynamic pages
- Created `getStaticRoutes.ts` utility to automatically discover static routes
- Added deduplication to prevent duplicate entries

### 3. Created Route Discovery Utility (`src/utilities/getStaticRoutes.ts`)

- Automatically scans the `src/app/(frontend)` directory
- Discovers all static routes with `page.tsx/ts/js/jsx` files
- Excludes Next.js special directories and dynamic routes
- Provides fallback manual route list if auto-discovery fails

### 4. Added Testing Script

- `scripts/test-sitemap.js` - Test script to verify route discovery
- `pnpm test:sitemap` - NPM script to run the test

## How It Works Now

### Static Sitemap (generated by next-sitemap)

- Main sitemap at `/sitemap.xml`
- Includes all static pages from the build
- Excludes admin, API, and system routes
- References additional dynamic sitemaps

### Dynamic Sitemaps (generated by Next.js API routes)

- `/pages-sitemap.xml` - Contains both static frontend routes and Payload CMS pages
- `/posts-sitemap.xml` - Contains all published posts from Payload CMS
- Both are server-side generated and cached

### Robot.txt

- Generated automatically
- Disallows crawling of admin and API routes
- References all sitemap files

## Files Modified

1. `next-sitemap.config.cjs` - Fixed main sitemap configuration
2. `src/app/(frontend)/(sitemaps)/pages-sitemap.xml/route.ts` - Enhanced dynamic sitemap
3. `src/utilities/getStaticRoutes.ts` - New utility for route discovery
4. `package.json` - Added test script
5. `scripts/test-sitemap.js` - New testing script

## Routes Now Included

All static frontend routes will be automatically discovered, including:

- `/` (home)
- `/about`
- `/academic-cv-writing-service`
- `/ats-resume-writing-service`
- `/cancellation-and-refund`
- `/career-roadmap-service`
- `/career-tools`
- `/contact`
- `/cover-letter-writing-service`
- `/executive-resume-writing-service`
- `/free-resume-review`
- `/interview-coaching-service`
- `/jobseekers-combo-service`
- `/linkedin-profile-makeover`
- `/membership-application-service`
- `/pricing`
- `/privacy-policy`
- `/project-portfolio`
- `/search`
- `/services`
- `/sop-writing-service`
- `/terms-and-conditions`
- `/thank-you-for-choosing-prosumely`
- `/visual-resume-writing-service`
- Plus any dynamic pages from Payload CMS
- Plus all published posts

## Testing

1. Build the project: `pnpm build`
2. Test route discovery: `pnpm test:sitemap`
3. Check generated sitemaps in `/public/` folder
4. Verify sitemap URLs in browser: `/sitemap.xml`, `/pages-sitemap.xml`, `/posts-sitemap.xml`

## Cache Invalidation

The dynamic sitemaps are cached and will be invalidated when:

- Pages are published/unpublished (triggers `pages-sitemap` tag revalidation)
- Posts are published/unpublished (triggers `posts-sitemap` tag revalidation)
